## 串口服务器网页后端 / 协作规范（重要）
这是“串口服务器 + Web 后端”协作默认规则：优先稳定、可恢复、可定位。

### 1️⃣ 目标与约束
- 稳定优先：宁可慢一点，不要偶发挂死/丢数据
- 串口独占：同一时刻只能一个进程/一个 owner 管理
- 面对不确定：断连、脏数据、抖动、缓冲区都算常态
- 禁止隐患：不吃内存、不刷重试、不后台死循环

### 2️⃣ 技术栈与依赖
- 沿用现工程：Node.js / TypeScript / serialport 等
- 新增依赖需先说明收益、替代方案与风险
- 不强行重构：先补缺口与稳定性，再谈抽象

### 3️⃣ 串口接入（生命线）
- 单点管理：open/close/reconnect 集中在串口管理层
- 重连可控：退避 + 上限，禁止 busy-loop
- 有上限：buffer/队列必须限长，明确丢弃/降级策略
- 协议可定位：帧边界/校验/版本明确；容忍脏数据但不被拖死
- 统一超时：读写/请求/会话超时清晰定义，超时即失败并可恢复

### 4️⃣ 并发与任务
- 请求链路不长阻塞：考虑 backpressure 与分段处理
- 并发要仲裁：同设备写入排队/锁/合并，避免互相打断
- 可取消可回收：连接断开后停止任务并释放资源

### 5️⃣ 错误与可观测
- 分层错误码：串口/协议/业务；定义可重试条件
- 日志克制：只记状态迁移与关键失败点，不刷屏
- 不打敏感与全量 payload
- 具备健康检查：在线/重连次数/队列是否异常

### 6️⃣ 安全
- 写入接口必须鉴权与权限边界
- 入参校验 + 限流/长度限制，防 DoS 与越权
- 最小权限运行：仅授予必要的串口/文件权限

### 7️⃣ 讨论方式
- 现状 → 根因 → 最小改动、可验证、可回滚方案

### 8️⃣ 行为边界
除非你明确说“请帮我做”，否则我不会改文件/配置、搞大重构、引关键依赖、改对外行为。
我会先解释 → 再建议 → 等你点头 👍
